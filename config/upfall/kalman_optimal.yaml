# UP-FALL Optimal Configuration
# Dataset: UP-FALL (Martinez-Villasenor et al. 2019)
# Using wrist accelerometer + gyroscope with Kalman fusion
#
# Dataset Info:
#   - 17 subjects
#   - 11 activities (5 falls: 1-5, 6 ADLs: 6-11)
#   - ~50Hz sampling rate
#   - Wrist accelerometer (cols 29-31) + gyroscope (cols 32-34)

model: Models.encoder_ablation.KalmanConv1dLinear
dataset: upfall

# Subject configuration
subjects: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]
validation_subjects: [15, 16]

# Model architecture (same as SmartFallMM optimal)
model_args:
  imu_frames: 128
  imu_channels: 7
  acc_frames: 128
  acc_coords: 7
  num_classes: 1
  num_heads: 4
  num_layers: 2
  embed_dim: 48
  dropout: 0.5
  activation: relu
  norm_first: True
  se_reduction: 4
  acc_ratio: 0.65

# Dataset preprocessing
dataset_args:
  csv_path: other_datasets/CompleteDataSet.csv
  mode: sliding_window
  max_length: 128
  task: fd
  stride: 32
  loss_type: focal

  # Required by Trainer (compatibility with SmartFallMM)
  modalities: [accelerometer, gyroscope]
  sensors: [wrist]
  age_group: [all]
  use_skeleton: False

  # Normalization
  enable_normalization: True
  normalize_modalities: acc_only

  # Class-aware stride (balance fall/ADL windows)
  enable_class_aware_stride: True
  fall_stride: 16
  adl_stride: 64

  # Gyroscope conversion (deg/s -> rad/s)
  convert_gyro_to_rad: True

  # Kalman fusion (scaled for 50Hz)
  enable_kalman_fusion: True
  kalman_filter_type: linear
  kalman_output_format: euler
  kalman_include_smv: True
  kalman_include_uncertainty: False
  kalman_include_innovation: False
  filter_fs: 50.0

  # Q/R scaled for 50Hz (32/50 = 0.64 scaling factor)
  kalman_Q_orientation: 0.003
  kalman_Q_rate: 0.006
  kalman_R_acc: 0.05
  kalman_R_gyro: 0.1

# Training parameters
batch_size: 64
test_batch_size: 64
val_batch_size: 64
num_epoch: 80

feeder: Feeder.external_datasets.ExternalFallDataset
train_feeder_args:
  batch_size: 64
val_feeder_args:
  batch_size: 64
test_feeder_args:
  batch_size: 64

seed: 2
optimizer: adamw
base_lr: 0.001
weight_decay: 0.001
